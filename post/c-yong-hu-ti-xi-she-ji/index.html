<html>
  <head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>C用户体系设计 | Loniper</title>
<link rel="shortcut icon" href="https://loniper.github.io/favicon.ico?v=1587096391475">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://loniper.github.io/styles/main.css">

<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/moment.js/2.23.0/moment.min.js"></script>



  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://loniper.github.io">
  <img class="avatar" src="https://loniper.github.io/images/avatar.png?v=1587096391475" alt="">
  </a>
  <h1 class="site-title">
    Loniper
  </h1>
  <p class="site-description">
    loniper的碎碎念
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          首页
        </a>
      
    
      
        <a href="/archives" class="menu">
          归档
        </a>
      
    
      
        <a href="/tags" class="menu">
          标签
        </a>
      
    
      
        <a href="/post/about" class="menu">
          关于
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
        <a href="https://twitter.com/loniper/" target="_blank">
          <i class="fab fa-twitter"></i>
        </a>
      
    
      
        <a href="https://weibo.com/loniper/" target="_blank">
          <i class="fab fa-weibo"></i>
        </a>
      
    
      
    
      
        <a href="https://facebook.com/jiangteng/" target="_blank">
          <i class="fab fa-facebook"></i>
        </a>
      
    
  </div>
</div>


        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              C用户体系设计
            </h2>
            <div class="post-info">
              <time class="post-time">
                · 2017-08-16 ·
              </time>
              
                <a href="https://loniper.github.io/tag/think/" class="post-tag">
                  # 随想
                </a>
              
            </div>
            
              <div class="post-feature-image" style="background-image: url('http://d.loniper.com/2G7hDH+')">
              </div>
            
            <div class="post-content">
              <p>根据我司的商业定位，设计一套平台化的C用户体系，要求能满足以下条件：</p>
<blockquote>
<ol>
<li>所有C用户在斑马平台下有且只有唯一的用户编号;</li>
<li>所有C用户在家政公司下有不同的用户资料，但基于条件1，需实现各家政公司下的免登录下单。</li>
</ol>
</blockquote>
<!-- more -->
<p>通过研究<a href="https://www.youzan.com">有赞</a>的用户体系，决定借鉴其部分实现方式，即以平台公众号的openid/unionid为线，完成平台化用户的打通。</p>
<p>再通过研究微信公众平台的接口资料，得出以下信息：</p>
<blockquote>
<ol>
<li>一个C用户在任一APP_公众号_小程序下的openid是不同的，但当同一家公司的公众号/小程序绑定至开放平台下时，C用户在这家公司下的unionid是唯一的；</li>
<li>通过网页授权形式，可以获取到C用户在任一微信公众号下的openid，因此可以通过两次回调的方式，获取到C用户在平台公众号和家政公司公众号下的openid。</li>
</ol>
</blockquote>
<p>基于此，可设计用户体系如下图所示：</p>
<figure data-type="image" tabindex="1"><img src="http://d.loniper.com/2G7hDH+" alt="" loading="lazy"></figure>
<p>为简化接口，可不做已有用户手机号_平台openid_家政公司openid的绑定，因此只需以下三个接口：</p>
<blockquote>
<ol>
<li>通过家政公司openid/unionid判断是否存在用户编号；</li>
<li>通过平台openid判断是否存在用户编号；</li>
<li>条件1和2均为否时，创建新用户编号。</li>
</ol>
</blockquote>
<p>以上，即是本次C用户体系改造的设计过程。</p>

            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">下一篇</div>
            <a href="https://loniper.github.io/post/ying-xiong-xie-mu/">
              <h3 class="post-title">
                英雄谢幕
              </h3>
            </a>
          </div>
        

        

        <div class="site-footer">
  why so seriou ? fairness is in chaos . | 
  <a class="rss" href="https://loniper.github.io/atom.xml" target="_blank">RSS</a>
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>

      </div>
    </div>
  </body>
</html>
